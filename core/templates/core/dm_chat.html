{% extends 'core/base.html' %}
{% load static %}
{% block content %}

<style>
/* å…¨ä½“ã®ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ */
.chat-wrapper {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    padding-bottom: 80px;
}

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ */
.chat-box {
    padding: 10px;
    margin-top: 10px;
}

/* è¡Œï¼ˆã‚¢ã‚¤ã‚³ãƒ³ï¼‹å¹ãå‡ºã—ï¼‰ */
.chat-row {
    display: flex;
    align-items: flex-end;
    margin: 10px 0;
}

/* è‡ªåˆ†ã®è¡Œ */
.chat-row.me {
    justify-content: flex-end;
}

/* ç›¸æ‰‹ã®è¡Œ */
.chat-row.other {
    justify-content: flex-start;
}

/* ã‚¢ã‚¤ã‚³ãƒ³ */
.chat-icon {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #ccc;
}

/* å¹ãå‡ºã— */
.bubble {
    max-width: 70%;
    padding: 10px 15px;
    border-radius: 15px;
    font-size: 15px;
    margin: 0 8px;
}

/* è‡ªåˆ†ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
.bubble.me {
    background: #aee2ff;
    border-bottom-right-radius: 0;
    text-align: right;
}

/* ç›¸æ‰‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
.bubble.other {
    background: #e5e5ea;
    border-bottom-left-radius: 0;
}

/* ğŸ”½ æˆ»ã‚‹ãƒœã‚¿ãƒ³ä»˜ãã‚¿ã‚¤ãƒˆãƒ« */
.dm-header {
    display: flex;
    align-items: center;
    margin: 10px auto 0;
    max-width: 600px;
    padding: 5px 10px;
}
.dm-header a {
    font-size: 22px;
    text-decoration: none;
    margin-right: 10px;
}

/* é€ä¿¡ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆä¸‹å›ºå®šï¼‰ */
.chat-input-area {
    position: fixed;
    bottom: 55px;
    left: 0;
    width: 100%;
    background: white;
    padding: 8px;
    border-top: 1px solid #ccc;
}

.chat-input-area form {
    display: flex;
    width: 100%;
    gap: 8px;
}

.chat-input-area input[type="text"] {
    flex: 1;
    padding: 8px 10px;
    font-size: 15px;
    border: 1px solid #aaa;
    border-radius: 10px;
}

.chat-input-area button {
    padding: 8px 12px;
    background: #0095f6;
    color: white;
    border: none;
    border-radius: 10px;
}
</style>

<!-- ğŸ”™ æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼‹ã‚¿ã‚¤ãƒˆãƒ« -->
<div class="dm-header">
    <a href="{% url 'dm_list' %}">â†</a>
    <h2 style="margin: 0;">{{ other_user.username }} ã¨DM</h2>
</div>

<div class="chat-wrapper">
    <div class="chat-box">

        {% for msg in messages %}
            {% if msg.sender == request.user %}
            <!-- è‡ªåˆ† -->
            <div class="chat-row me">
                <div class="bubble me">
                    {{ msg.text }}<br>
                    <small style="font-size:10px; color:#555;">
                        {{ msg.created_at|date:"H:i" }}
                    </small>
                </div>
                <img
                    src="{% if msg.sender.profile.profile_image %}
                            {{ msg.sender.profile.profile_image.url }}
                         {% else %}
                            {% static 'core/default_icon.png' %}
                         {% endif %}"
                    class="chat-icon"
                >
            </div>

            {% else %}
            <!-- ç›¸æ‰‹ -->
            <div class="chat-row other">
                <img
                    src="{% if msg.sender.profile.profile_image %}
                            {{ msg.sender.profile.profile_image.url }}
                         {% else %}
                            {% static 'core/default_icon.png' %}
                         {% endif %}"
                    class="chat-icon"
                >
                <div class="bubble other">
                    {{ msg.text }}<br>
                    <small style="font-size:10px; color:#555;">
                        {{ msg.created_at|date:"H:i" }}
                    </small>
                </div>
            </div>
            {% endif %}
        {% endfor %}

    </div>
</div>

<!-- é€ä¿¡ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="chat-input-area">
    <form method="POST">
        {% csrf_token %}
        <input type="text" name="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›â€¦" required>
        <button type="submit">é€ä¿¡</button>
    </form>
</div>

{% endblock %}